<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Orders</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

  <style>
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 20px;
      margin-top: 100px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    .action-btn {
      padding: 6px 12px;
      background-color: #d9534f;
      color: white;
      border: none;
      cursor: pointer;
    }
    .action-btn:hover {
      background-color: #c9302c;
    }
    .sidebar {
      width: 200px;
      height: 100vh;
      background: #343a40;
      color: white;
      position: fixed;
      left: -200px;  /* Hidden by default */
      top: 0;
      transition: left 0.3s;
      padding: 10px;
      z-index: 1000;
      
    }
    .sidebar.active {
      left: 0;
      
    }
    /* Toggle Button Styles */
    .toggle-btn {
      position: fixed;
      top: 80px;
      left: 0;
      background: #343a40;
      color: white;
      padding: 10px;
      cursor: pointer;
      z-index: 1100;
      border-top-right-radius: 5px;
      border-bottom-right-radius: 5px;
      
    }
    a {
            text-decoration: none; /* Underline remove cheyyan */
            color: rgb(255, 255, 255); /* Link color black aakkan */
        }
        li{
          padding-left: 20px;
        }
  </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="#"> (CHOCOZZ) admin-panel  </a>
        <div>
          <button class="btn btn-warning btn-sm" onclick="goToMain()">Go to Main Page</button>

        </div>
    </div>
</nav>
       <!-- Toggle Button -->
       <div class="toggle-btn" onclick="toggleSidebar()">
        â˜°
      </div>
      
      <!-- Sidebar -->
      <div class="sidebar" id="sidebar">
        <h5 class="text-center">Admin Menu</h5>
        <ul class="text-light">
          <li><a href="admin-panel.html">Dashboard</a></li>
          <li><a href="orders.html">Orders</a></li>
          <li><a href="customer-details.html">customer details</a></li>
          <li><a href="tesimonial admin.html">Testimonials</a></li>
        </ul>
      </div>

  
  <div id="ordersContainer"></div>
  
  <script>

function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('active');
    }
    function goToMain() {
            window.location.href = "index.html";
        }

    // Function to render the orders table
    function renderOrdersTable() {
      const orders = JSON.parse(localStorage.getItem('orders')) || [];
      const container = $('#ordersContainer');
      container.empty();

      if (orders.length === 0) {
        container.html('<p>No orders found.</p>');
        return;
      }

      // Create table with headers
      let table = $(`
        <table>
          <thead>
            <tr>
              <th>Order #</th>
              <th>Customer</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Address</th>
              <th>Payment Method</th>
              <th>Products (Name, Qty, Price)</th>
              <th>Total Amount</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      `);

      orders.forEach((order, index) => {
        const customer = order.customerDetails;
        const products = order.products || [];
        
        // Create address string
        const address = `${customer.house}, ${customer.street}, ${customer.town}, ${customer.district}, ${customer.state}, ${customer.pin}`;
        
        // Build a string for products details
        let productsStr = '';
        let totalAmount = 0;
        products.forEach(product => {
          productsStr += `${product.name} (Qty: ${product.quantity}, Price: ${product.price})<br>`;
          totalAmount += product.price * product.quantity;
        });
        
        // Create a row for this order with a delete button
        const row = $(`
          <tr>
            <td>${index + 1}</td>
            <td>${customer.name}</td>
            <td>${customer.email}</td>
            <td>${customer.phone}</td>
            <td>${address}</td>
            <td>${customer.paymentMethod}</td>
            <td>${productsStr}</td>
            <td>${totalAmount}</td>
            <td><button class="action-btn" data-index="${index}">Delete</button></td>
          </tr>
        `);
        table.find('tbody').append(row);
      });

      container.append(table);
    }

    // Function to delete an order and update localStorage
    function deleteOrder(index) {
      let orders = JSON.parse(localStorage.getItem('orders')) || [];
      orders.splice(index, 1);
      localStorage.setItem('orders', JSON.stringify(orders));
      renderOrdersTable();
    }

    // On document ready, render the orders table and bind delete events
    $(document).ready(function () {
      renderOrdersTable();

      // Delegate click event for dynamically created delete buttons
      $('#ordersContainer').on('click', '.action-btn', function () {
        const index = $(this).data('index');
        if (confirm('Are you sure you want to delete this order?')) {
          deleteOrder(index);
        }
      });
    });
  </script>
</body>
</html>
