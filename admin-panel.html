<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { font-family: Arial, sans-serif; }
        .small-input { font-size: 14px; padding: 5px; }
        .form-container { max-width: 400px; margin: auto; }
        #preview-image { width: 100px; margin-top: 5px; display: none; }
         /* Sidebar Styles */
    .sidebar {
      width: 200px;
      height: 100vh;
      background: #343a40;
      color: white;
      position: fixed;
      left: -200px;  /* Hidden by default */
      top: 0;
      transition: left 0.3s;
      padding: 10px;
      z-index: 1000;
    }
    .sidebar.active {
      left: 0;
    }
    /* Toggle Button Styles */
    .toggle-btn {
      position: fixed;
      top: 70px;
      left: 0;
      background: #343a40;
      color: white;
      padding: 10px;
      cursor: pointer;
      z-index: 1100;
      border-top-right-radius: 5px;
      border-bottom-right-radius: 5px;
    }
    a{
            text-decoration: none; /* Underline remove cheyyan */
            color: rgb(255, 255, 255); /* Link color black aakkan */
        }
        li{
          padding-left: 20px;
        }
    </style>
</head>
<body onload="checkLogin()">


      <!-- Toggle Button -->
  <div class="toggle-btn" onclick="toggleSidebar()">
    ☰
  </div>
  
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <h5 class="text-center">Admin Menu</h5>
    <ul>
      <li><a href="admin-panel.html">Dashboard</a></li>
      <li><a href="orders.html">Orders</a></li>
      <li><a href="customer-details.html">customer details</a></li>
      <li><a href="tesimonial admin.html">testimonial-form</a></li>
    </ul>
  </div>


    <!-- Login Section -->
    <div id="login-section" class="d-flex justify-content-center align-items-center vh-100">
        <div class="card p-4 shadow-sm w-25">
            <h4 class="text-center mb-3">Admin Login</h4>
            <input type="text" id="username" class="form-control mb-2 small-input" placeholder="Username">
            <input type="password" id="password" class="form-control mb-2 small-input" placeholder="Password">
            <button class="btn btn-primary w-100 btn-sm" onclick="login()">Login</button>
        </div>
    </div>

    <!-- Admin Section -->
    <div id="admin-section" class="d-none">
        <nav class="navbar navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="#">(CHOCOZZ) admin-panel </a>
                <div>
                    <button class="btn btn-warning btn-sm" onclick="goToMain()">Go to Main Page</button>
                    <button class="btn btn-danger btn-sm" onclick="logout()">Logout</button>
                </div>
            </div>
        </nav>

        <div class="container mt-3">
            <h5 class="text-center mt-5 mb-4">Add / Edit Product</h5>
            <div class="form-container">
                <form onsubmit="addOrUpdateProduct(event)">
                    <input type="hidden" id="edit-index">
                    <input type="text" id="product-name" class="form-control mb-2 small-input" placeholder="Product Name" required>
                    <input type="number" id="product-price" class="form-control mb-2 small-input" placeholder="Price (₹)" required>
                    <input type="number" id="product-stock" class="form-control mb-2 small-input" placeholder="Stock" required>
                    <input type="file" id="product-image" class="form-control mb-2 small-input" accept="image/*">
                    <img id="preview-image">
                    <button type="submit" id="submit-btn" class="btn btn-success w-100 btn-sm">Add Product</button>
                </form>
            </div>
            
            <h4 class="mt-4 ms-5">Product List</h4>
            <table class="table table-bordered mt-2">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Stock</th>
                        <th>Image</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="product-table"></tbody>
            </table>
        </div>
    </div>
    
    

    <script>

          // Sidebar toggle function
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('active');
    }

        function checkLogin() {
            let isLoggedIn = localStorage.getItem("isLoggedIn");
            document.getElementById("login-section").classList.toggle("d-none", isLoggedIn === "true");
            document.getElementById("admin-section").classList.toggle("d-none", isLoggedIn !== "true");
            if (isLoggedIn === "true") loadProducts();
        }

        function login() {
            if (document.getElementById("username").value === "admin" && document.getElementById("password").value === "admin123") {
                localStorage.setItem("isLoggedIn", "true");
                checkLogin();
            } else {
                alert("Invalid Username or Password!");
            }
        }

        function logout() {
            localStorage.removeItem("isLoggedIn");
            checkLogin();
        }

        function goToMain() {
            window.location.href = "index.html";
        }

        function addOrUpdateProduct(event) {
        event.preventDefault();
        let name = document.getElementById("product-name").value;
        let price = document.getElementById("product-price").value;
        let stock = document.getElementById("product-stock").value;
        let imageInput = document.getElementById("product-image");
        let editIndex = document.getElementById("edit-index").value;
        let products = JSON.parse(localStorage.getItem("products")) || [];

        if (editIndex) {
            let existingImage = products[editIndex].image;

            if (imageInput.files.length > 0) {
                let reader = new FileReader();
                reader.onload = function (e) {
                    products[editIndex] = { name, price, stock, image: e.target.result };
                    saveAndReload(products);
                };
                reader.readAsDataURL(imageInput.files[0]);
            } else {
                products[editIndex] = { name, price, stock, image: existingImage };
                saveAndReload(products);
            }

            alert("Product Updated Successfully!");
        } else {
            if (imageInput.files.length === 0) {
                alert("Please upload an image!");
                return;
            }
            let reader = new FileReader();
            reader.onload = function (e) {
                products.push({ name, price, stock, image: e.target.result });
                saveAndReload(products);
            };
            reader.readAsDataURL(imageInput.files[0]);

            alert("Product Added Successfully!");
        }
        
        clearForm(); // Clears the form after submission
    }

    function clearForm() {
        document.getElementById("product-name").value = "";
        document.getElementById("product-price").value = "";
        document.getElementById("product-stock").value = "";
        document.getElementById("product-image").value = "";
        document.getElementById("edit-index").value = "";
        document.getElementById("submit-btn").textContent = "Add Product";
        document.getElementById("preview-image").style.display = "none";
    }

    function editProduct(index) {
        let products = JSON.parse(localStorage.getItem("products")) || [];
        let product = products[index];

        document.getElementById("product-name").value = product.name;
        document.getElementById("product-price").value = product.price;
        document.getElementById("product-stock").value = product.stock;
        document.getElementById("edit-index").value = index;
        document.getElementById("submit-btn").textContent = "Update Product";
        document.getElementById("preview-image").src = product.image;
        document.getElementById("preview-image").style.display = "block";

        alert("Editing Product: " + product.name);
    }

    function deleteProduct(index) {
        let products = JSON.parse(localStorage.getItem("products")) || [];
        if (confirm("Are you sure you want to delete this product?")) {
            products.splice(index, 1);
            saveAndReload(products);
            alert("Product Deleted Successfully!");
        }
    }

    function saveAndReload(products) {
        localStorage.setItem("products", JSON.stringify(products));
        loadProducts();
        clearForm(); // Clears the form after saving
    }

    function loadProducts() {
        let products = JSON.parse(localStorage.getItem("products")) || [];
        let tableBody = document.getElementById("product-table");
        tableBody.innerHTML = "";
        products.forEach((product, index) => {
            let row = `<tr>
                <td>${product.name}</td>
                <td>₹${product.price}</td>
                <td>${product.stock}</td>
                <td><img src="${product.image}" width="50"></td>
                <td>
                    <button class="btn btn-warning btn-sm" onclick="editProduct(${index})">Edit</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteProduct(${index})">Delete</button>
                </td>
            </tr>`;
            tableBody.innerHTML += row;
        });
    }
    document.addEventListener('DOMContentLoaded', function () {
    let orders = JSON.parse(localStorage.getItem('orders')) || [];
    let orderTableBody = document.getElementById('orderTableBody');

    orders.forEach(order => {
        order.products.forEach(product => {
            let row = `
                <tr>
                    <td>${order.name}</td>
                    <td>${order.phone}</td>
                    <td>${order.email}</td>
                    <td>${order.address.house}, ${order.address.street}, ${order.address.town}, ${order.address.district}, ${order.address.state} - ${order.address.pin}</td>
                    <td>${order.paymentMethod}</td>
                    <td>${product.name}</td>
                    <td>${product.price}</td>
                    <td>${product.qty}</td>
                </tr>
            `;
            orderTableBody.innerHTML += row;
        });
    });
});
    </script>
</body>
</html>
